{
  "filename": "08-Install-Harbor.md",
  "__html": "<h1 id=\"%E5%85%AB%E3%80%81harbor%E7%A7%81%E6%9C%8D%E6%90%AD%E5%BB%BA\">八、Harbor私服搭建 <a class=\"header-anchor\" href=\"#%E5%85%AB%E3%80%81harbor%E7%A7%81%E6%9C%8D%E6%90%AD%E5%BB%BA\">#</a></h1>\n<ul>\n<li><a href=\"https://goharbor.io/\">https://goharbor.io/</a></li>\n<li><a href=\"https://github.com/goharbor/harbor/releases\">https://github.com/goharbor/harbor/releases</a></li>\n</ul>\n<h3 id=\"1.-%E5%AE%89%E8%A3%85\">1. 安装 <a class=\"header-anchor\" href=\"#1.-%E5%AE%89%E8%A3%85\">#</a></h3>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> 创建安装目录</span>\nmkdir /usr/local/harbor\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> 下载安装包</span>\nwget https://github.com/goharbor/harbor/releases/download/v1.10.13-rc1/harbor-offline-installer-v1.10.13-rc1.tgz -O /usr/local/harbor/harbor-offline-installer-v1.10.13-rc1.tgz\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> 解压安装包</span>\ntar xzvf /usr/local/harbor/harbor-offline-installer-v1.10.13-rc1.tgz -C /usr/local/harbor/\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> 备份配置文件</span>\ncp harbor.yml harbor.yml.bak\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> 新建配置文件</span>\nvim harbor.md\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> 配置文件重命名</span>\nmv harbor.md harbor.yml\n</code></pre>\n<h3 id=\"2.-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE\">2. 初始化配置 <a class=\"header-anchor\" href=\"#2.-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE\">#</a></h3>\n<pre><code class=\"language-yaml\"><span class=\"hljs-comment\"># 服务的名称或ip</span>\n<span class=\"hljs-comment\"># hostname: harbor.light.com</span>\n<span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.137</span><span class=\"hljs-number\">.102</span>\n\n<span class=\"hljs-comment\"># 启动端口</span>\n<span class=\"hljs-attr\">http:</span>\n  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">5080</span>\n\n<span class=\"hljs-comment\"># 初始密码</span>\n<span class=\"hljs-attr\">harbor_admin_password:</span> <span class=\"hljs-string\">Harbor12345</span>\n\n<span class=\"hljs-comment\"># 默认使用内置postgresql 用户为 root</span>\n<span class=\"hljs-attr\">database:</span>\n  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">root123</span>\n  <span class=\"hljs-attr\">max_idle_conns:</span> <span class=\"hljs-number\">50</span>\n  <span class=\"hljs-attr\">max_open_conns:</span> <span class=\"hljs-number\">100</span>\n\n<span class=\"hljs-comment\"># 数据卷volume</span>\n<span class=\"hljs-attr\">data_volume:</span> <span class=\"hljs-string\">/data</span>\n\n<span class=\"hljs-comment\"># 日志配置</span>\n<span class=\"hljs-attr\">log:</span>\n  <span class=\"hljs-attr\">level:</span> <span class=\"hljs-string\">info</span>\n  <span class=\"hljs-attr\">local:</span>\n    <span class=\"hljs-attr\">rotate_count:</span> <span class=\"hljs-number\">50</span>\n    <span class=\"hljs-attr\">rotate_size:</span> <span class=\"hljs-string\">200M</span>\n    <span class=\"hljs-attr\">location:</span> <span class=\"hljs-string\">/usr/local/harbor/log</span>\n\n<span class=\"hljs-comment\"># jobservice的最大工作线程</span>\n<span class=\"hljs-attr\">jobservice:</span>\n  <span class=\"hljs-attr\">max_job_workers:</span> <span class=\"hljs-number\">2</span>\n\n<span class=\"hljs-comment\"># Web hook 任务的最大重试次数</span>\n<span class=\"hljs-attr\">notification:</span>\n  <span class=\"hljs-attr\">webhook_job_max_retry:</span> <span class=\"hljs-number\">2</span>\n\n<span class=\"hljs-comment\"># 禁用 chart</span>\n<span class=\"hljs-attr\">chart:</span>\n  <span class=\"hljs-attr\">absolute_url:</span> <span class=\"hljs-string\">disabled</span>\n</code></pre>\n<p>执行简单安装</p>\n<blockquote>\n<p>/usr/local/harbor/harbor/install.sh</p>\n</blockquote>\n<p>访问Web页面: <a href=\"http://192.168.137.102:5080\">http://192.168.137.102:5080</a></p>\n<ul>\n<li>admin/Harbor12345</li>\n</ul>\n<h3 id=\"3.-%E4%BD%BF%E7%94%A8\">3. 使用 <a class=\"header-anchor\" href=\"#3.-%E4%BD%BF%E7%94%A8\">#</a></h3>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> 创建用户</span>\nhliu/Liuhui1993\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> 创建项目 关联用户</span>\npi-diginn\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> 镜像命名格式 参考推送镜像命令 harbor-server/PROJECT/IMAGE[:TAG]</span>\n192.168.137.102:5080/pi-diginn/pd-service-admin:4.0.0 # 合法命名\n192.168.137.102:5080/pd-service-admin:4.0.0           # 非法命名\n\ndocker login --username=hliu --password=Liuhui1993 192.168.137.102:5080\ndocker push 192.168.137.102:5080/pi-diginn/pd-service-admin:4.0.0\ndocker logout\n</code></pre>\n<p>卸载Harbor</p>\n<blockquote>\n<p>cd /usr/local/harbor/harbor/\ndocker-compose stop</p>\n</blockquote>\n",
  "link": "/en-us/docs/CI-CD/08-Install-Harbor.html",
  "meta": {}
}