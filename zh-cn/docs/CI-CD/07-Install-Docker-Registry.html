<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="07-Install-Docker-Registry" />
	<meta name="description" content="07-Install-Docker-Registry" />
	<!-- 网页标签标题 -->
	<title>07-Install-Docker-Registry</title>
	<link rel="shortcut icon" href="/light-docs/img/docsite.ico"/>
	<link rel="stylesheet" href="/light-docs/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/light-docs/zh-cn/index.html"><img class="logo" src="/light-docs/img/dubbo_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/light-docs/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/light-docs/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/light-docs/zh-cn/docs/site/Overview.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/light-docs/zh-cn/blog/index.html" target="_self">博客</a></li><li class="menu-item menu-item-normal"><a href="/light-docs/zh-cn/community/index.html" target="_self">社区</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/light-docs/img/system/docs.png" class="front-img"/><span>文档</span><img src="/light-docs/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>Light Docs</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/light-docs/zh-cn/docs/site/Overview.html" target="_self">概览</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/light-docs/zh-cn/docs/site/Quick-Start.html" target="_self">快速开始</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/light-docs/zh-cn/docs/site/Developer-Guide.html" target="_self">开发指南</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/light-docs/zh-cn/docs/single/00-Docsite-Usage.html" target="_self">Docsite 使用</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>开发环境<img style="transform:rotate(-90deg)" class="menu-toggle" src="/light-docs/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/devenv/DevEnv.html" target="_self">总览</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/devenv/Docker-Mysql.html" target="_self">Mysql</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/devenv/Docker-Pgsql.html" target="_self">Pgsql</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/devenv/Docker-Redis.html" target="_self">Redis</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/devenv/Docker-InfluxDB.html" target="_self">InfluxDB</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/devenv/Docker-EMQX.html" target="_self">EMQX</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Spring Boot<img style="transform:rotate(-90deg)" class="menu-toggle" src="/light-docs/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/Spring-Boot/Spring-Boot.html" target="_self">Spring Boot</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Spring Cloud<img style="transform:rotate(-90deg)" class="menu-toggle" src="/light-docs/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/Spring-Cloud/Spring-Cloud.html" target="_self">Spring Cloud</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Spring Security<img style="transform:rotate(-90deg)" class="menu-toggle" src="/light-docs/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/Spring-Security/Spring-Security.html" target="_self">Spring Security</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>CI/CD<img style="transform:rotate(-90deg)" class="menu-toggle" src="/light-docs/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/CI-CD/01-Install-JDK.html" target="_self">Install JDK</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/CI-CD/02-Install-NodeJS.html" target="_self">Install NodeJS</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/CI-CD/03-Install-Maven.html" target="_self">Install Maven</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/CI-CD/04-Install-Gitea.html" target="_self">Install Gitea</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/CI-CD/05-Install-Nexus3.html" target="_self">Install Nexus3</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/CI-CD/06-Install-Jenkins.html" target="_self">Install Jenkins</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/CI-CD/07-Install-Docker Registry.html" target="_self">Install Docker Registry</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/CI-CD/08-Install-Harbor.html" target="_self">Install Harbor</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>K8s<img style="transform:rotate(-90deg)" class="menu-toggle" src="/light-docs/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/K8s/K8s-Single-Master-Cluster.html" target="_self">K8s单Master集群</a></li><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/K8s/Use-Rancher-build-K8s-Cluster.html" target="_self">使用Rancher搭建K8s集群</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Linux<img style="transform:rotate(-90deg)" class="menu-toggle" src="/light-docs/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/light-docs/zh-cn/docs/Linux/Ntp-Time-Sync.html" target="_self">Linux服务器时间同步</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><h1 id="%E4%B8%83%E3%80%81-%E5%AE%89%E8%A3%85-docker-registry%E7%A7%81%E6%9C%8D">七、 安装 Docker Registry私服 <a class="header-anchor" href="#%E4%B8%83%E3%80%81-%E5%AE%89%E8%A3%85-docker-registry%E7%A7%81%E6%9C%8D">#</a></h1>
<p>这是最简洁最原始的方式，使用docker官方的提供的registry来搭建私服。优点是纯净、简洁，缺点是没有可视化界面、没有权限验证模块。</p>
<h3 id="1.-%E5%AE%89%E8%A3%85">1. 安装 <a class="header-anchor" href="#1.-%E5%AE%89%E8%A3%85">#</a></h3>
<pre><code class="language-shell"><span class="hljs-meta">#</span><span class="bash"> 安装运行 Registry</span>
docker run -d \
  --publish 5000:5000 \ 
  --volume /usr/local/registry/data:/var/lib/registry \
  --privileged=true \
  --restart=always \
  --name registry \
  registry:2
<span class="hljs-meta">
#</span><span class="bash"> 测试向私服推送镜像</span>
docker pull alpine
docker tag alpine:latest 192.168.137.102:5000/alpine:latest
docker push 192.168.137.102:5000/alpine:latest
<span class="hljs-meta">
#</span><span class="bash"> 跳过Https限制</span>
vim /etc/docker/daemon.json
{
  "registry-mirrors": ["https://rv4ppfhe.mirror.aliyuncs.com"],
  "exec-opts": ["native.cgroupdriver=systemd"],
  "insecure-registries": [
        "192.168.137.101:5000",
        "192.168.137.102:5000"
  ]
}
<span class="hljs-meta">
#</span><span class="bash"> 查看所有镜像</span>
curl -X GET http://192.168.137.102:5000/v2/_catalog
<span class="hljs-meta">#</span><span class="bash"> 查看指定镜像的所有版本</span>
curl -X GET http://192.168.137.102:5000/v2/alpine/tags/list
</code></pre>
<p>访问Web: <a href="http://192.168.137.102:5000/v2/">http://192.168.137.102:5000/v2/</a></p>
<h3 id="2.-%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81%E8%AE%A4%E8%AF%81(%E8%B7%B3%E8%BF%87)">2. 登录密码认证(跳过) <a class="header-anchor" href="#2.-%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81%E8%AE%A4%E8%AF%81(%E8%B7%B3%E8%BF%87)">#</a></h3>
<pre><code class="language-shell"><span class="hljs-meta">#</span><span class="bash"> 停止并删除容器</span>
docker stop registry &amp;&amp; docker rm registry
<span class="hljs-meta">
#</span><span class="bash"> 创建保存账号密码的文件</span>
mkdir /usr/local/registry/auth
docker run --entrypoint htpasswd registry -Bbn admin admin &gt; /usr/local/registry/auth/htpasswd
<span class="hljs-meta">
#</span><span class="bash"> 重新启动容器</span>
docker run -d \
  --publish 5000:5000 \ 
  --volume /usr/local/registry/data:/var/lib/registry \
  --volume /usr/local/registry/auth:/auth \
  --env "REGISTRY_AUTH=htpasswd" \
  --env "REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm" \
  --env  REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd \
  --privileged=true \
  --restart=always \
  --name registry \
  registry:2
</code></pre>
<h3 id="3.-%E5%88%A0%E9%99%A4%E5%B7%B2%E7%BB%8F%E4%B8%8A%E4%BC%A0%E7%9A%84%E9%95%9C%E5%83%8F">3. 删除已经上传的镜像 <a class="header-anchor" href="#3.-%E5%88%A0%E9%99%A4%E5%B7%B2%E7%BB%8F%E4%B8%8A%E4%BC%A0%E7%9A%84%E9%95%9C%E5%83%8F">#</a></h3>
<ol>
<li>打开镜像的存储目录，如有-V操作打开挂载目录也可以，删除镜像文件夹</li>
</ol>
<blockquote>
<p>docker exec &lt;容器名&gt; rm -rf /var/lib/registry/docker/registry/v2/repositories/&lt;镜像名&gt;</p>
</blockquote>
<ol start="2">
<li>执行垃圾回收操作，注意2.4版本以上的registry才有此功能</li>
</ol>
<blockquote>
<p>docker exec registry bin/registry garbage-collect /etc/docker/registry/config.yml</p>
</blockquote>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/light-docs/img/dubbo_gray.png"/><div class="cols-container"><div class="col col-12"><h3>免责声明</h3><p>站点由 https://docsite.js.org 构建</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/light-docs/zh-cn/docs/site/Overview.html" target="_self">概览</a></dd><dd><a href="/light-docs/zh-cn/docs/site/Quick-Start.html" target="_self">快速开始</a></dd><dd><a href="/light-docs/zh-cn/docs/site/Developer-Guide.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/light-docs/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/light-docs/zh-cn/community/index.html" target="_self">社区</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2018 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span></div><div class="poweredBy"><span>Poered By: https://github.com/txd-team/docsite</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '/light-docs';
  </script>
	<script src="/light-docs/build/documentation.js"></script>
</body>
</html>